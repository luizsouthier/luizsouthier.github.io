<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>User Pok√©dex Generator</title>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="jquery.csv.js"></script>
	<script type="text/javascript" src="a.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.12.0/js/md5.min.js"></script>
	<script src="test.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Baloo+Bhai&display=swap" rel="stylesheet">
    <style>
body {
	font-family: Roboto !important;
}
h1 {
  margin: auto;
  font-weight: 300;
  color: #7758ec;
  text-align: center;
  font-weight: bold;
  border-bottom: 5px solid #7758ec;
  width: 100%;
  font-size: 30pt;
  line-height: 26pt;
}

#pokemon-form {
  width: 100%;
  margin: 5px auto;
  text-align: center;
}

#top {
  width: 100%;
  position: fixed; top: 0px; left: 0px; 
  background: white;
  z-index: 999
}

#data {
  width: 100%;
}

#pokemon-form textarea {
  text-align: left;
  padding: 5px;
  margin: 5px auto;
  width: 99%;
  border: 0px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
}

#pokemon-form textarea:focus {
  outline: none !important;
  border: 0px solid #98a4ef;
}

#pokemon-form button {
  display: inline-block;
  margin: 5px auto;
  background: #cabcff;
  border: none;
  border-radius: 30px;
  color: white;
  font-weight: 300;
  font-size: 12pt;
  padding: 10px;
  trasition: 0.5s;
}

#pokemon-form button:hover {
  cursor: pointer;
}

#pokemon-form button:focus {
  outline: none !important;
  background: #755bd8;
  trasition: 0.5s;
}

.user-pokedex {
  background: #cabcff;
  text-align: center;
  border-radius: 50px;
  width: 120px;
  height: 220px !important;
  color: white;
  font-weight: 300;
  padding: 10px;
  display: inline-block;
  margin: 5px;
}

.user-pokedex.background {
  background: #cabcff;
  text-align: center;
  border-radius: 20px;
  width: 120px;
  height: 200px !important;
  color: white;
  font-weight: 300;
  padding: 10px;
  display: inline-block;
  margin: 5px;
}

.user-pokedex .name {
	font-size: 12pt;
	margin: 5px auto;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
  width: 119px;
}

.user-pokedex .image-regular,
.user-pokedex .image-shiny {
  height: 102px;
  max-height: 102px;
  text-align: center;
}

.user-pokedex img {
  margin: auto;
}

.user-pokedex .image-shiny {
  display: none;
}

.user-pokedex.shiny .image-regular,
.user-pokedex.shinyFemale .image-regular,
.user-pokedex.shinyMale .image-regular {
  display: none;
}

.user-pokedex.shiny .image-shiny,
.user-pokedex.shinyFemale .image-shiny,
.user-pokedex.shinyMale .image-shiny {
  display: block;
}

.user-pokedex .lucky-btn {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/8/8c/Pokedex_lucky.png/revision/latest?cb=20210920120825);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.lucky .lucky-btn {
  filter: grayscale(0%);
}

.user-pokedex .shiny-switch {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/3/31/Shiny_Pok%C3%A9mon.png/revision/latest?cb=20171026223519);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shiny .shiny-switch {
  filter: grayscale(0%);
}

.user-pokedex .dynamax-switch {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/f/f3/Pokedex_gmax.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.dynamax .dynamax-switch {
  filter: grayscale(0%);
}

.user-pokedex .shadow-switch {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/7/76/Icon_Shadow_Pok√©mon.png/revision/latest/?cb=20190715225723);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shadow .shadow-switch {
  filter: grayscale(0%);
}

.user-pokedex .purified-switch {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/5/52/Icon_Purified_Pok√©mon.png/revision/latest/?cb=20190715225729);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.purified .purified-switch {
  filter: grayscale(0%);
}

.user-pokedex .perfect-switch {
  background-image: url(https://vignette.wikia.nocookie.net/pokemongo/images/6/6a/Appraisal_Rating_4.png/revision/latest?cb=20190716115838);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.perfect .perfect-switch {
  filter: grayscale(0%);
}

.user-pokedex .shinyShadow-switch {
  background-image: url(shinyShadow.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shinyShadow .shinyShadow-switch {
  filter: grayscale(0%);
}

.user-pokedex .shinyPurified-switch {
  background-image: url(shinyPurified.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shinyPurified .shinyPurified-switch {
  filter: grayscale(0%);
}

.user-pokedex .perfectMale-switch {
  background-image: url(male4.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.perfectMale .perfectMale-switch {
  filter: grayscale(0%);
}

.user-pokedex .perfectFemale-switch {
  background-image: url(female4.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.perfectFemale .perfectFemale-switch {
  filter: grayscale(0%);
}


.user-pokedex .shinyMale-switch {
  background-image: url(maleS.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shinyMale .shinyMale-switch {
  filter: grayscale(0%);
}

.user-pokedex .shinyFemale-switch {
  background-image: url(femaleS.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.shinyFemale .shinyFemale-switch {
  filter: grayscale(0%);
}


.optional-switch {
  min-height: 30px;
}


.user-pokedex.lucky {
  background: linear-gradient(to top, #403a96 0%, #cabcff 100%) !important;
}

.user-pokedex.dynamax {
  background: linear-gradient(to top, #cabcff 0%, #cabcff 70%, #933d68 100%) !important;
}

.user-pokedex.dynamax.lucky {
  background: linear-gradient(to top, #403a96 0%, #cabcff 70%, #933d68 100%) !important;
}


.user-pokedex.shadow .image-regular,
.user-pokedex.shadow .image-shiny {
  background: url("https://vignette.wikia.nocookie.net/pokemongo/images/e/e1/Shadow_effect.png/revision/latest?cb=20230523105016") center 0 no-repeat !important;
}

.user-pokedex.purified .image-regular,
.user-pokedex.purified .image-shiny {
  background: url("light.png") center 0 no-repeat !important;
}

.user-pokedex.difference .perfect-switch {
  display: none;
}

.user-pokedex.background {
  height: 150px !important;
}

.user-pokedex.background .image-regular{
  filter: grayscale(90%);
}

.user-pokedex .hasbackground-switch {
  background-image: url(background.png);
  background-size: 24px 24px;
  margin: 3px auto;
  width: 24px;
  height: 24px;
  filter: grayscale(100%);
  cursor: pointer;
  display: inline-block;
}

.user-pokedex.hasbackground .hasbackground-switch,
.user-pokedex.background.hasbackground .image-regular{
  filter: grayscale(0%);
}


</style>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2655301318011533"
     crossorigin="anonymous"></script>
</head>
<body>
	<div id="top">
    <form id="pokemon-form" action="" onsubmit="return false;">
	<table width="100%"><tr>
	<td><input type="file" id="myFileInput" style="display:none"/>   
		<button id="export-code">Export file</button><br>
		<button id="open-file" onclick="document.getElementById('myFileInput').click()">Open file</button></td>
	<td>

		<button id="show-all">Clear filters</button>
		<button id="missing-background">Missing Background</button><br>
		<button onclick="window.location.href='bgtrade.html'">For trade</button>
		<button id="btn-relatorio-location">Missing report</button>

	</td>
	</tr></table>
        
    </form>
	</div>
	<div id="data">
	<h1>Special Background</h1>
    <div id="Special" style="text-align: center; margin: auto;"></div>
	<h1>Location Background</h1>
    <div id="Location" style="text-align: center; margin: auto;"></div>
	</div>	
	<script>
	getPokemon();

$('#data').css('margin-top', function() {
    return $('#top').height();
});

function getPokemon() {
    $.ajax({
        url: "data.csv",
        dataType: "text",
        success: function(serverCsv) {
            // conseguiu carregar do servidor
            var data = $.csv.toObjects(serverCsv, { separator: ',' });
			
             // üîΩ Ordena apenas as regi√µes "Location" e "Special"
            var sorted = data.map(function(p) { return p; }); // copia o array

            // Filtra os que precisam ser ordenados
            var specialGroups = sorted.filter(p => p.region === "Location" || p.region === "Special");
            var others = sorted.filter(p => p.region !== "Location" && p.region !== "Special");

            // Ordena os "Location" e "Special" por n e depois por name
            specialGroups.sort(function(a, b) {
                var nA = parseInt(a.n);
                var nB = parseInt(b.n);
                if (nA !== nB) return nA - nB;
                var nameA = a.name.toLowerCase();
                var nameB = b.name.toLowerCase();
                if (nameA < nameB) return -1;
                if (nameA > nameB) return 1;
                return 0;
            });

            // Junta de volta mantendo os outros na ordem original
            data = others.concat(specialGroups);
            createPokemon(data);
        },
        error: function() {
            // se n√£o conseguiu, usa a vari√°vel global csvString
            if (typeof csvString !== "undefined" && csvString) {
                var data = $.csv.toObjects(csvString, { separator: ',' });
				// üîΩ Mesmo comportamento no fallback
                var specialGroups = data.filter(p => p.region === "Location" || p.region === "Special");
                var others = data.filter(p => p.region !== "Location" && p.region !== "Special");

                specialGroups.sort(function(a, b) {
                    var nA = parseInt(a.n);
                    var nB = parseInt(b.n);
                    if (nA !== nB) return nA - nB;
                    var nameA = a.name.toLowerCase();
                    var nameB = b.name.toLowerCase();
                    if (nameA < nameB) return -1;
                    if (nameA > nameB) return 1;
                    return 0;
                });

                data = others.concat(specialGroups);
                createPokemon(data);
            } else {
                console.error("Nenhum CSV dispon√≠vel (nem servidor, nem vari√°vel global).");
            }
        }
    });
}


function getImageUrl(name) {

	if(name == "Pikachu libre") name = "Pikachu female libre";
	if(name == "Pikachu pop") name = "Pikachu female pop";
	if(name == "Pikachu rock") name = "Pikachu female rock";
	if(name == "Pikachu phd") name = "Pikachu female phd";
	
	if(name == "Pikachu libre shiny") name = "Pikachu female libre shiny";
	if(name == "Pikachu pop shiny") name = "Pikachu female pop shiny";
	if(name == "Pikachu rock shiny") name = "Pikachu female rock shiny";
	if(name == "Pikachu phd shiny") name = "Pikachu female phd shiny";
	
	if(name == "Spinda 1") name = "Spinda";
	if(name == "Spinda 2") name = "Spinda pattern 2";
	if(name == "Spinda 3") name = "Spinda pattern 3";
	if(name == "Spinda 4") name = "Spinda pattern 4";
	if(name == "Spinda 5") name = "Spinda pattern 5";
	if(name == "Spinda 6") name = "Spinda pattern 6";
	if(name == "Spinda 7") name = "Spinda pattern 7";
	if(name == "Spinda 8") name = "Spinda pattern 8";
	if(name == "Spinda 9") name = "Spinda pattern 9";

	if(name == "Spinda 1 shiny") name = "Spinda shiny";
	if(name == "Spinda 2 shiny") name = "Spinda pattern 2 shiny";
	if(name == "Spinda 3 shiny") name = "Spinda pattern 3 shiny";
	if(name == "Spinda 4 shiny") name = "Spinda pattern 4 shiny";
	if(name == "Spinda 5 shiny") name = "Spinda pattern 5 shiny";
	if(name == "Spinda 6 shiny") name = "Spinda pattern 6 shiny";
	if(name == "Spinda 7 shiny") name = "Spinda pattern 7 shiny";
	if(name == "Spinda 8 shiny") name = "Spinda pattern 8 shiny";
	if(name == "Spinda 9 shiny") name = "Spinda pattern 9 shiny";
	
    let baseUrl = 'https://vignette.wikia.nocookie.net/pokemongo/images',
        filename = `${name}.png`.replace(/ /g, '_'),
        digest = md5(filename),
        filepath = `${digest[0]}/${digest[0]}${digest[1]}/${encodeURIComponent(filename)}`;
    return `${baseUrl}/${filepath}`;
}

function applyCSV(csvText) {
    const rows = csvText.split("\n").filter(r => r.trim() !== "");
    if (rows.length < 2) return;

    const headers = rows[0].split(",").map(h => h.trim()); // remove espa√ßos extras

    for (let i = 1; i < rows.length; i++) {
        const cols = rows[i].split(",").map(c => c.trim()); // remove \r e espa√ßos
        const pokemonId = cols[0];
        const card = document.getElementById(pokemonId);
        if (!card) continue;

        // Limpa todas as classes que podem ser importadas
        card.classList.remove(
            "dynamax","lucky","perfectMale","perfectFemale",
            "perfect","shinyMale","shinyFemale","shiny",
            "shadow","shinyShadow","purified","shinyPurified","hasbackground"
        );

        // Marca classes com base no CSV
        if (cols[headers.indexOf("dynamax")] === "TRUE") card.classList.add("dynamax");
        if (cols[headers.indexOf("lucky")] === "TRUE") card.classList.add("lucky");
        if (cols[headers.indexOf("perfectMale")] === "TRUE") card.classList.add("perfectMale");
        if (cols[headers.indexOf("perfectFemale")] === "TRUE") card.classList.add("perfectFemale");
        if (cols[headers.indexOf("perfect")] === "TRUE") card.classList.add("perfect");
        if (cols[headers.indexOf("shinyMale")] === "TRUE") card.classList.add("shinyMale");
        if (cols[headers.indexOf("shinyFemale")] === "TRUE") card.classList.add("shinyFemale");
        if (cols[headers.indexOf("shiny")] === "TRUE") card.classList.add("shiny");
        if (cols[headers.indexOf("shadow")] === "TRUE") card.classList.add("shadow");
        if (cols[headers.indexOf("shinyShadow")] === "TRUE") card.classList.add("shinyShadow");
        if (cols[headers.indexOf("purified")] === "TRUE") card.classList.add("purified");
        if (cols[headers.indexOf("shinyPurified")] === "TRUE") card.classList.add("shinyPurified");
		if (cols[headers.indexOf("hasbackground")] === "TRUE") card.classList.add("hasbackground");
    }
}

function createPokemon(list) {
	var region = ["1Kanto", "2Johto", "3Hoenn", "4Sinnoh", "5Unova", "6Kalos", "7Alola", "8Galar", "9Hisui", "9Paldea", "Event", "Gigantamax", "Mega"];
	var background = ["Special", "Location"];
	

	for(j = 0; j < background.length; j++) {
		var tekst = "";
		var el = document.getElementById(background[j]);
		for (i = 0; i < list.length; i++) {
		
		
		let nome = list[i]['gender'];
		nome = nome.replace('Location_Background_', '');
		nome = nome.replace('Special_Background_', '');
		nome = nome.replace('Location Background ', '');
		nome = nome.replace('Location Background', '');
		nome = nome.replace('Special Background ', '');
		nome = nome.replace('Location Card', '');
		nome = nome.replace('Special Card ', '');
		nome = nome.replace('.png', '');
		
		
			if(list[i]['region'] == background[j]) {
				tekst += '<div id="' + list[i]['name'] + list[i]['gender']+'" class="user-pokedex background" data-bg="' + list[i]['gender'];
				tekst += '"><div class="image-regular" style="background:url(' +getImageUrl(list[i]['gender']) + ') center/cover no-repeat;"><img src="' + getImageUrl(list[i]['name']) + '" width="100" height="100"></div><div class="name">' + ('0000'+list[i]['n']).slice(-4)+' ' + list[i]['name'] +'<br>'+nome+'</div><div class="caught-switch"><div class="hasbackground-switch"></div></div></div>';

			}
		}
		el.innerHTML = tekst;
	}
	

	$(document).ready(function () {
// handler robusto com delegation - funciona mesmo se voc√™ recriar os elementos
$(document).on('click', '.hasbackground-switch', function () {
    const item = $(this).closest('.background');
    // procura especificamente o ancestor #Special ou #Location
    const regionContainer = item.closest('#Special, #Location');
    const regionName = regionContainer.length ? regionContainer.attr('id') : null;
    const bgType = item.data('bg'); // tipo de background (o que voc√™ guardou em data-bg)
    const isOn = item.hasClass('hasbackground');

    // Se n√£o achou o container Special/Location, cair fora
    if (!regionName) {
        console.warn('Region container not found for background item:', item);
        return;
    }

    // 1) Regi√£o SPECIAL ‚Üí comportamento antigo (toggle s√≥ nele)
    if (regionName === "Special") {
        item.toggleClass('hasbackground');
        return;
    }

    // 2) Regi√£o LOCATION ‚Üí comportamento novo
    if (regionName === "Location") {
        if (!isOn) {
            // Primeiro clique: marca TODOS do mesmo tipo (Location)
            $('.background[data-bg="' + bgType + '"]').addClass('hasbackground');
        } else {
            // Segundo clique: desmarca apenas o clicado
            item.removeClass('hasbackground');
        }
        return;
    }
});

});


    $(document).ready(function () {
        $('.shiny-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('shiny');
        });
    });
    $(document).ready(function () {
        $('.shadow-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('shadow');
        });
    });
	
	
    $(document).ready(function () {
        $('.perfect-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('perfect');
        });
    });
	
	
    $(document).ready(function () {
        $('.perfectMale-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('perfectMale');
        });
    });
	
    $(document).ready(function () {
        $('.perfectFemale-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('perfectFemale');
        });
    });	
	
    $(document).ready(function () {
        $('.shinyMale-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('shinyMale');
        });
    });
	
    $(document).ready(function () {
        $('.shinyFemale-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('shinyFemale');
        });
    });	
	
	$(document).ready(function () {
		$('.purified-switch').click(function () {
			const container = $(this).closest(".caught"); // pega o elemento pai
			const isPurified = container.hasClass('purified');
			container.toggleClass('purified');

				if (!isPurified) {
				container.addClass('shadow');
			}
		});
	});
	$(document).ready(function () {
		$('.shinyPurified-switch').click(function () {
			const container = $(this).closest(".caught"); // pega o elemento pai
			const isPurified = container.hasClass('shinyPurified');


			container.toggleClass('shinyPurified');
			if (!isPurified) {
				container.addClass('purified');
			}
		});
	});
	
	$(document).ready(function () {
		$('.shinyShadow-switch').click(function () {
			const container = $(this).closest(".caught"); // pega o elemento pai
			const isPurified = container.hasClass('shinyShadow');


			container.toggleClass('shinyShadow');
			if (!isPurified) {
				container.addClass('shadow');
			}
		});
	});

	
	$(document).ready(function () {
        $('.dynamax-switch').click(function () {
            $(this).parent().parent(".caught").toggleClass('dynamax');
        });
    });
	
	$(document).ready(function () {
        $('.lucky-btn').click(function () {
            $(this).parent().parent(".caught").toggleClass('lucky');
        });
    });

	
	$(document).ready(function () {
        $("#show-all").click(function () {
			$(".user-pokedex").show();
		
		});
    });
	
	$(document).ready(function () {
        $("#show-difference").click(function () {
			$(".user-pokedex:not('.difference')").hide();
		
		});
    });
	
	$(document).ready(function () {
        $("#show-shiny").click(function () {
			$(".user-pokedex.not-shiny").hide();
		
		});
    });
	
	$(document).ready(function () {
        $("#show-shadow").click(function () {
			$(".user-pokedex.not-shadow").hide();
		
		});
    });
	
	$(document).ready(function () {
        $("#show-shinyShadow").click(function () {
			$(".user-pokedex.not-shinyShadow").hide();
		
		});
    });
	
	$(document).ready(function () {
        $("#show-dynamax").click(function () {
			$(".user-pokedex.not-dynamax").hide();
		
		});
    });	
	
	
	$(document).ready(function () {
        $("#missing-lucky").click(function () {
			$(".user-pokedex.lucky").hide();
		
		});
    });

	
	$(document).ready(function () {
        $("#missing-background").click(function () {
			$(".user-pokedex.hasbackground").hide();
		
		});
    });
	
	$(document).ready(function () {
        $("#missing-shiny").click(function () {
			$(".user-pokedex.shiny").hide();
			$(".user-pokedex.not-shiny").hide();
			$(".user-pokedex.shinyMale.shinyFemale").hide();
		});
    });
	
	$(document).ready(function () {
        $("#missing-shadow").click(function () {
			$(".user-pokedex.shadow").hide();
			$(".user-pokedex.not-shadow").hide();
		});
    });
	
	$(document).ready(function () {
        $("#missing-purified").click(function () {
			$(".user-pokedex.purified").hide();
			$(".user-pokedex.not-shadow").hide();
		});
    });
		
	$(document).ready(function () {
        $("#missing-shinyShadow").click(function () {
			$(".user-pokedex.shinyShadow").hide();
			$(".user-pokedex.not-shinyShadow").hide();
		});
    });
	
	$(document).ready(function () {
        $("#missing-shinyPurified").click(function () {
			$(".user-pokedex.shinyPurified").hide();
			$(".user-pokedex.not-shinyShadow").hide();
		});
    });
	
	$(document).ready(function () {
        $("#missing-dynamax").click(function () {
			$(".user-pokedex.dynamax").hide();
			$(".user-pokedex.not-dynamax").hide();
		});
    });
		
	$(document).ready(function () {
        $("#missing-perfect").click(function () {
			$(".user-pokedex.perfect").hide();
			$(".user-pokedex.perfectMale.perfectFemale").hide();
		});
    });

$(document).ready(function () {

    $("#export-code").click(function () {
	
	   console.log(list);

        // Cria array para armazenar as linhas do CSV
        let csvRows = [];
        // Cabe√ßalho
        csvRows.push([
            "name","dynamax","lucky","perfectMale","perfectFemale",
            "perfect","shinyMale","shinyFemale","shiny","shadow","shinyShadow","purified","shinyPurified","hasbackground"
        ].join(","));

        // Percorre cada Pok√©mon
        for (let i = 0; i < list.length; i++) {
            let pokemon = document.getElementById(list[i]['name'] + list[i]['gender'])||document.getElementById(list[i]['name']);
			
			
			if(pokemon.classList.contains('background')){
			
				nome = list[i]['name']+list[i]['gender'];
				console.log(nome);
			
			}else{
			
				nome = list[i]['name'];
			
			}
			
			
			
			let row = [
					nome,
					pokemon.classList.contains('dynamax') ? 'TRUE' : '',
					pokemon.classList.contains('lucky') ? 'TRUE' : '',
					pokemon.classList.contains('perfectMale') ? 'TRUE' : '',
					pokemon.classList.contains('perfectFemale') ? 'TRUE' : '',
					pokemon.classList.contains('perfect') ? 'TRUE' : '',
					pokemon.classList.contains('shinyMale') ? 'TRUE' : '',
					pokemon.classList.contains('shinyFemale') ? 'TRUE' : '',
					pokemon.classList.contains('shiny') ? 'TRUE' : '',
					pokemon.classList.contains('shadow') ? 'TRUE' : '',
					pokemon.classList.contains('shinyShadow') ? 'TRUE' : '',
					pokemon.classList.contains('purified') ? 'TRUE' : '',
					pokemon.classList.contains('shinyPurified') ? 'TRUE' : '',
					pokemon.classList.contains('hasbackground') ? 'TRUE' : ''
				];
            
            

            csvRows.push(row.join(","));
        }

        // Cria o CSV
        const csvString = csvRows.join("\n");
        const blob = new Blob([csvString], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);

        // Cria link e dispara download
        const downloadLink = document.createElement("a");
        downloadLink.href = url;
        downloadLink.download = "myDex.csv";
        downloadLink.click();
        URL.revokeObjectURL(url);
    });

    // Importa√ß√£o do CSV
    $(document).ready(function () {
        $("#myFileInput").on('change', function(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                applyCSV(e.target.result);
            }
            reader.readAsText(event.target.files[0]);
        });
    });

});

}



</script>
<script>
// ---------------------------------------------------------
//  RELAT√ìRIO DE BACKGROUNDS FALTANDO ‚Äî APENAS LOCATION
// ---------------------------------------------------------
$(document).on('click', '#btn-relatorio-location', function () {

    const imagens = new Set();

    // SOMENTE OS CARDS DENTRO DE #Location
    const cards = $('#Location .user-pokedex, #Location .pokedex-card, #Location .location-card');

    cards.each(function () {
        const $card = $(this);

        // se tem background confirmado, pula
        if ($card.hasClass('hasbackground')) return;

        // tenta obter a imagem de fundo
        let bg = $card.find('.image-regular').css('background-image');

        // fallback para estilo inline
        if ((!bg || bg === 'none') && $card.find('.image-regular').attr('style')) {
            const s = $card.find('.image-regular').attr('style');
            const m = s.match(/url\((['"]?)(.*?)\1\)/);
            if (m) bg = `url("${m[2]}")`;
        }

        if (bg && bg !== 'none') {
            const m = bg.match(/url\((['"]?)(.*?)\1\)/);
            if (m && m[2]) imagens.add(m[2]);
        }
    });

    // remove relat√≥rio antigo
    $('#relatorio-location').remove();

    // monta o container
    const $cont = $('<div id="relatorio-location"></div>').css({
        'text-align': 'center',
        'margin': '40px auto',
        'padding': '16px',
        'border': '3px solid #7758ec',
        'border-radius': '12px',
        'background': '#f7f5ff',
    });

    $cont.append('<h2 style="color:#7758ec;margin-top:0">Looking For</h2>');

    if (imagens.size === 0) {
        $cont.append('<p><b>‚úî Nenhum background faltando em Location.</b></p>');
        $('body').append($cont);
        return;
    }

    const $grid = $('<div></div>').css({
        'display': 'flex',
        'flex-wrap': 'wrap',
        'justify-content': 'center',
        'gap': '12px'
    });

imagens.forEach(src => {
    const $box = $('<div></div>').css({
        'width': '140px',
        'padding': '8px',
        'border-radius': '10px',
        'background': 'white',
        'box-shadow': '0 4px 10px rgba(0,0,0,0.12)',
        'text-align': 'center'
    });

    const $img = $('<img>').attr('src', src).css({
        'width': '120px',
        'height': '80px',
        'object-fit': 'cover',
        'display': 'block',
        'margin': '0 auto'
    });

    // Extrair nome limpo
    let nome = src.split('/').pop();               // pega s√≥ o arquivo
		nome = nome.replace('Location_Background_', '');
		nome = nome.replace('Special_Background_', '');
		nome = nome.replace('Location Background ', '');
		nome = nome.replace('Location Background', '');
		nome = nome.replace('Special Background ', '');
		nome = nome.replace('Location Card', '');
		nome = nome.replace('Location_Card_', '');
		nome = nome.replace('Special Card ', '');
		nome = nome.replace('.png', '');

    const $label = $('<div></div>').text(nome).css({
        'margin-top': '6px',
        'font-size': '12px',
        'font-weight': '600',
        'color': '#333'
    });

    $box.append($img);
    $box.append($label);
    $grid.append($box);
});


    $cont.append($grid);
    $('body').append($cont);

    // rolar at√© o relat√≥rio
    $('html, body').animate({
        scrollTop: $('#relatorio-location').offset().top - 30
    }, 400);
	
    // ---------------------------------------------------------
    //  RELAT√ìRIO DE BACKGROUNDS FALTANDO ‚Äî SPECIAL (AUTOM√ÅTICO)
    // ---------------------------------------------------------

    // remove relat√≥rio antigo de special
    $('#relatorio-special').remove();

    const cardsSpecial = $('#Special .user-pokedex');

    const $contSpecial = $('<div id="relatorio-special"></div>').css({
        'text-align': 'center',
        'margin': '40px auto',
        'padding': '16px',
        'border': '3px solid #7758ec',
        'border-radius': '12px',
        'background': '#f7f5ff',    });

    $contSpecial.append('<h2 style="color:#7758ec;margin-top:0">Looking For ‚Äî Special</h2>');

    const $gridSpecial = $('<div></div>').css({
        'display': 'flex',
        'flex-wrap': 'wrap',
        'justify-content': 'center',
        'gap': '12px'
    });

    let countSpecial = 0;

    cardsSpecial.each(function () {
        const $card = $(this);

        // se j√° tem background, ignora
        if ($card.hasClass('hasbackground')) return;

        // tenta obter imagem de fundo
        let bg = $card.find('.image-regular').css('background-image');

        if ((!bg || bg === 'none') && $card.find('.image-regular').attr('style')) {
            const s = $card.find('.image-regular').attr('style');
            const m = s.match(/url\((['"]?)(.*?)\1\)/);
            if (m) bg = `url("${m[2]}")`;
        }

        if (!bg || bg === 'none') return;

        const m = bg.match(/url\((['"]?)(.*?)\1\)/);
        if (!m || !m[2]) return;

        countSpecial++;

        const src = m[2];
        const nomePokemon = $card.find('.name').text();

      const $box = $('<div></div>').css({
            'width': '160px',
            'padding': '8px',
            'border-radius': '10px',
            'background': 'white',
            'box-shadow': '0 4px 10px rgba(0,0,0,0.12)',
            'text-align': 'center'
        });

        // container visual (fundo + pokemon)
        const $visual = $('<div></div>').css({
            'width': '140px',
            'height': '100px',
            'margin': '0 auto',
            'border-radius': '8px',
            'background-image': `url(${src})`,
            'background-size': 'cover',
            'background-position': 'center',
            'position': 'relative',
            'overflow': 'hidden'
        });

        // imagem do Pok√©mon (por cima do fundo)
        const $pokemonImg = $('<img>').attr(
            'src',
            $card.find('img').attr('src') // usa a mesma imagem do card original
        ).css({
            'width': '80px',
            'height': '80px',
            'position': 'absolute',
            'bottom': '0',
            'left': '50%',
            'transform': 'translateX(-50%)'
        });

        const $label = $('<div></div>').text(nomePokemon).css({
            'margin-top': '6px',
            'font-size': '12px',
            'font-weight': '600',
            'color': '#333'
        });

        $visual.append($pokemonImg);
        $box.append($visual);
        $box.append($label);
        $gridSpecial.append($box);
    });

    if (countSpecial === 0) {
        $contSpecial.append('<p><b>‚úî Nenhum background faltando em Special.</b></p>');
    } else {
        $contSpecial.append($gridSpecial);
    }

    // adiciona logo abaixo do relat√≥rio de Location
    $('#relatorio-location').after($contSpecial);	
	
	
	
	
	
});




</script>


</body>
</html>